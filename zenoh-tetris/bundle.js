!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ZenohTetris=t():e.ZenohTetris=t()}(self,(()=>(()=>{"use strict";var e={912:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(601),i=n.n(r),o=n(314),s=n.n(o)()(i());s.push([e.id,'#control-overlay {\n    display: block; /* Ensure the overlay is displayed */\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0);\n}\n\n#control-buttons {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    width: 100vw;\n    height: 20vh;\n    /* Adjusted height for two rows */\n    display: flex;\n    flex-direction: column;\n    /* Arrange buttons in a column */\n    justify-content: space-around;\n    align-items: center;\n    background-color: rgba(255, 255, 255, 0);\n}\n\n#control-buttons .row {\n    display: flex;\n    justify-content: space-between;\n    /* Ensure buttons use all area wide */\n    width: 100%;\n    /* Use full width */\n    padding: 0 2.5vw;\n    /* Add padding to the sides */\n}\n\n#control-buttons button {\n    flex: 1;\n    /* Make buttons take equal space */\n    height: 7vh;\n    opacity: 0.5;\n    border: none;\n    font-size: 4vh;\n    margin: 0 1vw;\n    /* Add margin between buttons */\n}\n\n#down-btn {\n    flex: 2;\n    /* Make the "down" button 2-times wider */\n}\n\n.pause-btn {\n    position: fixed;\n    top: 10px;\n    right: 10px;\n    font-size: 4vh;\n    opacity: 0.5;\n    border: none;\n    background: none;\n}',""]);const a=s},837:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(601),i=n.n(r),o=n(314),s=n.n(o)()(i());s.push([e.id,"\n#score-overlay {\n    position: fixed;\n    top: 10px;\n    left: 10px;\n    background-color: rgba(0, 0, 0, 0.5);\n    color: white;\n    padding: 10px;\n    border-radius: 5px;\n    font-size: 20px;\n}",""]);const a=s},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(r)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);r&&s[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),t.push(c))}},t}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},s=[],a=0;a<e.length;a++){var l=e[a],u=r.base?l[0]+r.base:l[0],c=o[u]||0,h="".concat(u," ").concat(c);o[u]=c+1;var d=n(h),b={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(b);else{var f=i(b,r);r.byIndex=a,t.splice(a,0,{identifier:h,updater:f,references:1})}s.push(h)}return s}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var o=r(e=e||[],i=i||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var a=n(o[s]);t[a].references--}for(var l=r(e,i),u=0;u<o.length;u++){var c=n(o[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}o=l}}},659:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0;var r,i,o,s,a,l,u={};function c(e){return e>r.Empty}n.r(u),n.d(u,{Tetris:()=>N}),function(e){e[e.Empty=0]="Empty",e[e.FigureI=1]="FigureI",e[e.FigureJ=2]="FigureJ",e[e.FigureL=3]="FigureL",e[e.FigureO=4]="FigureO",e[e.FigureS=5]="FigureS",e[e.FigureT=6]="FigureT",e[e.FigureZ=7]="FigureZ",e[e.Blasted=100]="Blasted",e[e.Overlap=101]="Overlap"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Redraw=1]="Redraw",e[e.Collapse=2]="Collapse",e[e.Failure=3]="Failure"}(i||(i={})),function(e){e[e.Command=0]="Command",e[e.UpdateScore=1]="UpdateScore"}(o||(o={}));class h{constructor(e){Object.defineProperty(this,"event_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"command_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.event_id=o.Command,this.command_id=e}}!function(e){e[e.ShiftLeft=1]="ShiftLeft",e[e.ShiftRight=2]="ShiftRight",e[e.ShiftDown=3]="ShiftDown",e[e.RotateLeft=4]="RotateLeft",e[e.RotateRight=5]="RotateRight",e[e.FastDrop=6]="FastDrop"}(s||(s={})),function(e){e[e.Pause=101]="Pause",e[e.Play=102]="Play"}(a||(a={}));class d{constructor(e){Object.defineProperty(this,"event_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.event_id=o.UpdateScore,this.value=e}}class b{constructor(e,t){Object.defineProperty(this,"field",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rows",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"columns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.rows=e,this.columns=t,this.field=Array.from({length:e},(()=>Array(t).fill(r.Empty)))}getCellState(e,t,n=null){if(e<0||e>=this.rows||t<0||t>=this.columns)return r.Empty;if(n){const{row:i,column:o,shape:s,width:a}=n,l=e-i,u=t-o;if(l>=0&&l<s.length&&u>=0&&u<a&&s[l][u])return c(this.field[e][t])?r.Overlap:n.id}return this.field[e][t]}isFigureOverlaps(e){const{row:t,column:n,shape:r}=e;for(let e=0;e<r.length;e++)for(let i=0;i<r[e].length;i++)if(r[e][i]){const r=t+e,o=n+i;if(r>=0&&r<this.rows&&o>=0&&o<this.columns&&c(this.field[r][o]))return!0}return!1}isFigureOutOfBound(e){const{row:t,column:n}=e;return t<0||t+e.height>this.rows||n<0||n+e.width>this.columns}placeFigure(e){const{row:t,column:n,shape:i,id:o}=e;let s=!1;for(let e=0;e<i.length;e++)for(let a=0;a<i[e].length;a++)if(i[e][a]){const i=t+e,l=n+a;i>=0&&i<this.rows&&l>=0&&l<this.columns&&(c(this.field[i][l])&&(s=!0),this.field[i][l]=s?r.Overlap:o)}return!s}moveFigure(e,t){const n=e.move(t);return!this.isFigureOutOfBound(n)&&!this.isFigureOverlaps(n)&&(Object.assign(e,n),!0)}collapseStep(){for(let e=0;e<this.rows;e++)if(this.field[e].includes(r.Blasted))return this.field[e].fill(r.Empty),!1;for(let e=0;e<this.rows;e++)if(this.field[e].every((e=>c(e))))return this.field[e].fill(r.Blasted),!1;for(let e=this.rows-1;e>0;e--)if(this.field[e].every((e=>!c(e)))&&this.field[e-1].some((e=>c(e))))return this.field.splice(e,1),this.field.unshift(Array(this.columns).fill(r.Empty)),!1;return!0}}class f{get width(){return this.shape[0].length}get height(){return this.shape.length}}!function(e){e[e.R0=0]="R0",e[e.R90=1]="R90",e[e.R180=2]="R180",e[e.R270=3]="R270"}(l||(l={}));class p{constructor(e,t,n){if(Object.defineProperty(this,"row",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"column",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shapes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e instanceof p){const t=e;this.row=t.row,this.column=t.column,this.shapes=t.shapes,this.rotation=t.rotation,this.id=t.id}else{const r=e;this.row=t,this.column=n,this.shapes=this.generateRotations(r.shape),this.rotation=l.R0,this.id=r.id}}get shape(){return this.shapes[this.rotation]}get width(){return this.shape[0].length}get height(){return this.shape.length}move(e){const t=new p(this);switch(e){case s.ShiftLeft:t.column--;break;case s.ShiftRight:t.column++;break;case s.ShiftDown:t.row++;break;case s.RotateLeft:t.rotateLeft();break;case s.RotateRight:t.rotateRight()}return t}rotateRight(){this.rotation=(this.rotation+1)%4}rotateLeft(){this.rotation=(this.rotation+3)%4}generateRotations(e){const t=[e];for(let e=1;e<4;e++)t.push(this.rotateShape(t[e-1]));return t}rotateShape(e){const t=[];for(let n=0;n<e[0].length;n++){const r=[];for(let t=e.length-1;t>=0;t--)r.push(e[t][n]);t.push(r)}return t}}const m=[new class extends f{get id(){return r.FigureI}get shape(){return[[!0,!0,!0,!0]]}},new class extends f{get id(){return r.FigureJ}get shape(){return[[!0,!1,!1],[!0,!0,!0]]}},new class extends f{get id(){return r.FigureL}get shape(){return[[!0,!0,!0],[!0,!1,!1]]}},new class extends f{get id(){return r.FigureO}get shape(){return[[!0,!0],[!0,!0]]}},new class extends f{get id(){return r.FigureS}get shape(){return[[!1,!0,!0],[!0,!0,!1]]}},new class extends f{get id(){return r.FigureT}get shape(){return[[!1,!0,!1],[!0,!0,!0]]}},new class extends f{get id(){return r.FigureZ}get shape(){return[[!0,!0,!1],[!1,!0,!0]]}}];class v{constructor(e,t){Object.defineProperty(this,"field",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"figure",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.field=new b(e,t),this.figure=this.newFigure()}newFigure(){const e=Math.floor(Math.random()*m.length),t=m[e],n=Math.floor((this.field.columns-t.width)/2);return new p(t,0,n)}shiftLeft(){return this.field.moveFigure(this.figure,s.ShiftLeft)?i.Redraw:i.None}shiftRight(){return this.field.moveFigure(this.figure,s.ShiftRight)?i.Redraw:i.None}shiftDown(){return this.field.moveFigure(this.figure,s.ShiftDown)?i.Redraw:this.field.placeFigure(this.figure)?(this.figure=this.newFigure(),i.Collapse):i.Failure}rotateLeft(){return this.field.moveFigure(this.figure,s.RotateLeft)?i.Redraw:i.None}rotateRight(){return this.field.moveFigure(this.figure,s.RotateRight)?i.Redraw:i.None}collapseStep(){return this.field.collapseStep()?i.None:i.Collapse}getCellState(e,t){return this.field.getCellState(e,t,this.figure)}get rows(){return this.field.rows}get columns(){return this.field.columns}}function g(e){switch(e){case r.FigureI:return"cyan";case r.FigureJ:return"blue";case r.FigureL:return"orange";case r.FigureO:return"yellow";case r.FigureS:return"green";case r.FigureT:return"purple";case r.FigureZ:return"red";case r.Blasted:return"gray";case r.Overlap:return"black";default:return"white"}}class w{constructor(e,t,n){Object.defineProperty(this,"ctx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"game",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"collapse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"moveDownInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"collapseInterval",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"score",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"scoreChanged",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"resizeCanvas",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.ctx.canvas;e.width=e.clientWidth,e.height=e.clientHeight,this.enabled&&this.redraw()}});const r=document.createElement("canvas");r.style.width="100%",r.style.height="100%",r.style.display="none",e.appendChild(r),this.ctx=r.getContext("2d"),this.game=new v(t,n),this.collapse=!1,this.moveDownInterval=null,this.collapseInterval=null,this.enabled=!1,new ResizeObserver((()=>this.resizeCanvas())).observe(e),this.resizeCanvas()}handleResult(e){e===i.Failure?this.pause():e===i.Collapse?(this.collapse=!0,this.redraw()):e===i.Redraw&&this.redraw()}run(){this.moveDownInterval=setInterval((()=>{const e=this.game.shiftDown();this.handleResult(e)}),1e3),this.collapseInterval=setInterval((()=>{this.collapse&&(this.collapse=this.game.collapseStep()===i.Collapse,this.collapse&&(this.score+=1,this.scoreChanged=!0),this.redraw())}),200),this.redraw()}pause(){null!==this.moveDownInterval&&(clearInterval(this.moveDownInterval),this.moveDownInterval=null),null!==this.collapseInterval&&(clearInterval(this.collapseInterval),this.collapseInterval=null)}isPaused(){return null===this.moveDownInterval&&null===this.collapseInterval}restart(){this.pause(),this.game=new v(this.game.rows,this.game.columns),this.collapse=!1,this.run()}redraw(){!function(e,t){const n=e.canvas,i=Math.min((n.width-2*t.columns)/t.columns,(n.height-2*t.rows)/t.rows),o=(n.width-t.columns*i)/2,s=(n.height-t.rows*i)/2;e.clearRect(0,0,n.width,n.height);for(let n=0;n<t.rows;n++)for(let a=0;a<t.columns;a++){const l=t.getCellState(n,a);l!==r.Empty&&(e.fillStyle=g(l),e.fillRect(a*i+o,n*i+s,i,i))}e.strokeStyle="black",e.lineWidth=1,e.strokeRect(o,s,t.columns*i,t.rows*i)}(this.ctx,this.game)}getGame(){return this.game}enable(e){this.enabled=e,e?this.run():this.pause()}isEnabled(){return this.enabled}setVisible(e){this.ctx.canvas.style.display=e?"block":"none"}isVisible(){return"block"===this.ctx.canvas.style.display}async waitEvent(){return this.scoreChanged?(this.scoreChanged=!1,console.log(`Sending UpdateScore event with score: ${this.score}`),new d(this.score)):new Promise(((e,t)=>t()))}async handleEvent(e){if(e.event_id===o.Command){if(e.command_id===a.Pause)return void this.pause();if(e.command_id===a.Play)return void this.run();if(this.isPaused())return;let t;switch(e.command_id){case s.ShiftLeft:t=this.game.shiftLeft();break;case s.ShiftRight:t=this.game.shiftRight();break;case s.ShiftDown:t=this.game.shiftDown();break;case s.RotateRight:t=this.game.rotateRight();break;case s.RotateLeft:t=this.game.rotateLeft();break;case s.FastDrop:for(;this.game.shiftDown()===i.Redraw;)this.score+=1,this.scoreChanged=!0;t=i.Collapse;break;default:return}this.handleResult(t)}}}var y=n(72),P=n.n(y),O=n(825),C=n.n(O),S=n(659),R=n.n(S),j=n(56),x=n.n(j),F=n(540),E=n.n(F),k=n(113),L=n.n(k),A=n(912),I={};I.styleTagTransform=L(),I.setAttributes=x(),I.insert=R().bind(null,"head"),I.domAPI=C(),I.insertStyleElement=E(),P()(A.A,I);const M=A.A&&A.A.locals?A.A.locals:void 0;class D{constructor(e){Object.defineProperty(this,"container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"controlOverlay",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"commandQueue",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"resolveCommand",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"rejectCommand",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isPaused",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"mobileControlsVisible",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"togglePause",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.isPaused=!this.isPaused;const e=this.isPaused?new h(a.Pause):new h(a.Play);this.enqueueCommand(e),this.updatePauseButton(),this.updateMobileControls()}}),Object.defineProperty(this,"handleKeyEvent",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t=null;switch(e.key){case"ArrowLeft":t=new h(s.ShiftLeft);break;case"ArrowRight":t=new h(s.ShiftRight);break;case"ArrowDown":t=new h(s.ShiftDown);break;case"ArrowUp":t=new h(s.RotateRight);break;case" ":t=new h(s.FastDrop);break;case"p":return void this.togglePause()}null!==t&&this.enqueueCommand(t)}}),this.container=e,this.enabled=!1,/Mobi/i.test(navigator.userAgent)&&this.setVisibleMobileControls(!0),document.addEventListener("keydown",this.handleKeyEvent)}getControlOverlay(){if(!this.controlOverlay){this.controlOverlay=document.createElement("div"),this.controlOverlay.innerHTML='<div id="control-overlay"> <div id="control-buttons"> <div class="row"> <button id="rotate-left-btn" class="mobile-control-btn">&#x21BA;</button> <button id="fast-drop-btn" class="mobile-control-btn">&#x21E3;&#x21E3;</button> <button id="rotate-right-btn" class="mobile-control-btn">&#x21BB;</button> </div> <div class="row"> <button id="left-btn" class="mobile-control-btn">&#8592;</button> <button id="down-btn" class="mobile-control-btn">&#8595;</button> <button id="right-btn" class="mobile-control-btn">&#8594;</button> </div> </div> <button id="pause-btn" class="pause-btn">&#x23F8;</button> </div>',this.container.appendChild(this.controlOverlay);const e=document.createElement("style");e.textContent=M,document.head.appendChild(e),this.controlOverlay.querySelector("#left-btn").addEventListener("click",(()=>this.enqueueCommand(new h(s.ShiftLeft)))),this.controlOverlay.querySelector("#right-btn").addEventListener("click",(()=>this.enqueueCommand(new h(s.ShiftRight)))),this.controlOverlay.querySelector("#down-btn").addEventListener("click",(()=>this.enqueueCommand(new h(s.ShiftDown)))),this.controlOverlay.querySelector("#rotate-left-btn").addEventListener("click",(()=>this.enqueueCommand(new h(s.RotateLeft)))),this.controlOverlay.querySelector("#rotate-right-btn").addEventListener("click",(()=>this.enqueueCommand(new h(s.RotateRight)))),this.controlOverlay.querySelector("#fast-drop-btn").addEventListener("click",(()=>this.enqueueCommand(new h(s.FastDrop)))),this.controlOverlay.querySelector("#pause-btn").addEventListener("click",this.togglePause),this.updateMobileControls(),this.updatePauseButton()}return this.controlOverlay}updatePauseButton(){this.controlOverlay.querySelector("#pause-btn").innerHTML=this.isPaused?"&#x25B6;":"&#x23F8;"}enable(e){this.enabled=e,!e&&this.rejectCommand&&(this.rejectCommand(),this.rejectCommand=null)}isEnabled(){return this.enabled}setVisible(e){this.getControlOverlay().style.display=e?"block":"none"}isVisible(){return null!==this.controlOverlay&&"block"===this.controlOverlay.style.display}updateMobileControls(){let e=!this.isPaused&&this.mobileControlsVisible;this.getControlOverlay().querySelectorAll(".mobile-control-btn").forEach((t=>{t.style.display=e?"block":"none"}))}setVisibleMobileControls(e){this.mobileControlsVisible=e,this.updateMobileControls()}async waitEvent(){return this.commandQueue.length>0?this.commandQueue.shift():new Promise(((e,t)=>{this.resolveCommand=e,this.rejectCommand=t}))}async handleEvent(e){if(e.event_id===o.Command){if(e.command_id===a.Pause||e.command_id===a.Play)return this.isPaused=e.command_id===a.Pause,this.updatePauseButton(),void this.updateMobileControls();if(this.isPaused)return}}enqueueCommand(e){this.commandQueue.push(e),this.resolveCommand&&(this.resolveCommand(this.commandQueue.shift()),this.resolveCommand=null,this.rejectCommand=null)}}var T=n(837),q={};q.styleTagTransform=L(),q.setAttributes=x(),q.insert=R().bind(null,"head"),q.domAPI=C(),q.insertStyleElement=E(),P()(T.A,q);const _=T.A&&T.A.locals?T.A.locals:void 0;class V{constructor(e){Object.defineProperty(this,"container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scoreElement",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"score",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"enabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.container=e,this.scoreElement=document.createElement("div"),this.scoreElement.className="score-panel",this.scoreElement.innerHTML=' <div id="score-overlay"> <div id="score-display">Score: 0</div> </div>',this.container.appendChild(this.scoreElement);const t=document.createElement("style");t.textContent=_,document.head.appendChild(t),this.setVisible(!1)}updateScore(){this.scoreElement.querySelector("#score-display").innerHTML=`Score: ${this.score}`}enable(e){this.enabled=e}isEnabled(){return this.enabled}setVisible(e){this.scoreElement.style.display=e?"block":"none"}isVisible(){return"block"===this.scoreElement.style.display}async waitEvent(){return new Promise(((e,t)=>t()))}async handleEvent(e){e.event_id===o.UpdateScore&&this.enabled&&(this.score=e.value,this.updateScore())}}async function B(e,t){const n=e.map((e=>e.waitEvent()));try{const r=await Promise.race([Promise.any(n),new Promise(((e,n)=>setTimeout((()=>n(null)),t)))]);return null===r?null:(await Promise.all(e.map((async e=>{e.isEnabled()&&await e.handleEvent(r)}))),r)}catch{return null}}class N{constructor(e,t,n){Object.defineProperty(this,"tetrisPanel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"controlPanel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scorePanel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tetrisPanel=new w(e,t,n),this.controlPanel=new D(e),this.scorePanel=new V(e)}async run(){for(this.tetrisPanel.enable(!0),this.controlPanel.enable(!0),this.scorePanel.enable(!0),this.tetrisPanel.setVisible(!0),this.controlPanel.setVisible(!0),this.scorePanel.setVisible(!0),this.controlPanel.setVisibleMobileControls(!0);;)await B([this.tetrisPanel,this.controlPanel,this.scorePanel],100)}}return u})()));